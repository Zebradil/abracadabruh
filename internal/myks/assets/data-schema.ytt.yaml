#! This file define a schema for all ytt data files. It can also contain default values.
#! Top-level keys are scopes, e.g. application, argocd, environment, helm.
#! Content of the `application` scope can be freely modified. More scopes can be added.
#! The `environment`, `helm` and `argocd` scopes are used by myks and should not be modified.
#! However, more keys can be added to these scopes.

#@data/values-schema
#@overlay/match-child-defaults missing_ok=True
---
#! Add here any application-specific data.
application:
  #! Enable sync caching for application
  cache:
    enabled: true
  #! List of ytt packages to be rendered for the application.
  yttPkg:
    #@overlay/replace
    dirs:
      - ""
argocd:
  enabled: true
  #! Namespace of the ArgoCD server.
  namespace: argocd
  app:
    #! If not set, the name of the currently rendered application is used.
    name: ""
    #! Prefix of the ArgoCD application name.
    prefix: ""
    destination:
      #! spec.destination.name of the ArgoCD application.
      #! If not set, defaults to the name of the current environment.
      name: ""
      #! spec.destination.server of the ArgoCD application.
      #! If set, used instead of spec.destination.name.
      server: ""
      #! spec.destination.namespace of the ArgoCD application.
      #! If not set, defaults to argocd.app.name.
      namespace: ""
    source:
      #! spec.source.path of the ArgoCD application.
      #! If not set, defaults to the destination path of the currently rendered application.
      #! With the default myks configuration: `rendered/envs/<environment.id>/<app.name>`
      path: ""
      #! spec.source.repoURL of the ArgoCD application.
      #! If not set, defaults to the current git repository URL.
      repoURL: ""
      #! spec.source.targetRevision of the ArgoCD application.
      #! If not set, defaults to the current git branch.
      targetRevision: ""
  env:
    #! If not set, the name of the currently rendered environment is used (environment.id).
    name: ""
    #! Prefix of a target cluster name.
    prefix: ""
    #! If set to true, a dummy secret is generated for the target cluster.
    #! The user has to create an overlay to set correct values for the secret.
    #! See https://argo-cd.readthedocs.io/en/release-2.8/operator-manual/declarative-setup/#clusters
    #! TODO: add link to the example overlay.
    generateSecret: true
  project:
    #! If not set, the name of the currently rendered environment is used (environment.id).
    name: ""
    #! Prefix of the ArgoCD project name.
    prefix: ""
environment:
  #! Unique identifier of the environment, required by myks.
  #@schema/validation min_len=1
  #@schema/nullable
  id: ""
  #! List of applications to be deployed in the environment, required by myks.
  #@overlay/replace
  applications:
    - #! Prototype of the application, required by myks.
      #@schema/validation min_len=1
      proto: ""
      #! Name of the application, used by myks. If not defined, the name of the prototype is used.
      name: ""
#! Configuration of the step that renders Helm charts.
helm:
  #! Used by myks.
  #! If defined, passed as `--api-version` for `helm-template`.
  #@overlay/replace
  capabilities:
    - "" #! e.g. "monitoring.coreos.com/v1"
  #! Used by myks.
  #! If true, adds `--include-crds` flag to `helm template`.
  includeCRDs: true
  #! Used by myks.
  #! If defined, passed as a value of `--kube-version` for `helm template`.
  kubeVersion: ""
  #! Used by myks.
  #! If defined, passed as a value of `--namespace` for `helm template`.
  namespace: ""
#! Myks configuration and runtime data.
myks:
  #! Set by myks.
  #! Set to the current git branch if available.
  gitRepoBranch: ""
  #! Set by myks.
  #! Set to the current git repository URL if available.
  gitRepoUrl: ""
